<!DOCTYPE html><html><head><meta charset='utf-8'><meta http-equiv='Access-Control-Allow-Headers' content='Origin, X-Requested-With, Content-Type, Accept'><meta http-equiv='Access-Control-Allow-Methods' content='GET,POST,PUT,DELETE,OPTIONS'><meta http-equiv='Access-Control-Allow-Origin' content='*'><meta http-equiv='Access-Control-Allow-Credentials' content='true'><script src='https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js'></script><script src='https://fustyles.github.io/webduino/SpBlocklyJS/GameElements_20190131/marked.min.js'></script><script src='https://fustyles.github.io/webduino/SpBlocklyJS/GameElements_20190131/gameelements.js'></script><link rel='stylesheet' href='https://fustyles.github.io/webduino/SpBlocklyJS/css/icon_custom.css' /><script src='https://fustyles.github.io/webduino/SpBlocklyJS/TextToSpeech_20220729/texttospeech.js'></script><script src='https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js'></script><script src='https://fustyles.github.io/webduino/SpBlocklyJS/audioRecord_20250405/audioRecord.js'></script></head><body>
<script>
const delay = (seconds) => {
    return new Promise((resolve) => {
        setTimeout(resolve, seconds * 1000);
    });
};
const main = async () => {
    var GeminiKey, GeminiPrompt, result, jsonResult;


    GeminiKey = 'U2FsdGVkX1/MIm9hOJ9IzFNojuj9la0gCM3F/UoWyzQMEaO0ZO+9050jLQ7uJjuU9QyZpdRPjR3RUsGqfCgvNg==';
    GeminiPrompt = ['1. Transcribe the audio into text and the default language is Japanese or Chinese.\\n', '2. Return the result in the following JSON format:\\n', '{  "text": "Transcribed audio into text",   "language": "Japanese or Chinese",  "Chinese":"Chinese text or translate Japanese text into Traditional Chinese.", "Japanese":"Japanese text or rranslate Chinese text into Japanese." }\\n', '3. Do not use markdown syntax in reply.'].join('');
    head_add_viewport(0.95, 0.5, 2, "yes");
    ttsSetProperty(1, 1, 1, "ja-JP");
    ttsSwitch(1);
    span_create('Chinese', 40, 10, 18, '朗讀中文', 999);
    checkbox_create('Chinese', 10, 10, 18, '1', true, 1, 999, true);
    div_create('Chinese', 340, 270, 10, 40, "solid", 1, '#000000', '#ffffff', '#000000', 14, 1, '', 999, true);
    span_create('Japanese', 40, 320, 18, '日本語の音声読み上げ', 999);
    checkbox_create('Japanese', 10, 320, 18, '1', true, 1, 999, true);
    div_create('Japanese', 340, 270, 10, 350, "solid", 1, '#000000', '#ffffff', '#000000', 14, 1, '', 999, true);
    button_toolbox(110, 630, 80, 80, '#000000', '#ffcccc', 40, 1, 0,  [
        ['volume_up', 'Speaker'],
        ['mic', 'Recording']
    ]);
    button_set('mic', "borderradius", 40);
    button_set('volume_up', "borderradius", 40);
    button_set('mic', "borderradius", 40);
    recording_GeminiSTT_initial(0, (button_get('mic', "id")), (button_get('mic', "id")), (CryptoJS.AES.decrypt(GeminiKey, 'test').toString(CryptoJS.enc.Utf8)), "gemini-2.0-flash", GeminiPrompt);
    audioGeminiSTT = async function(geminiResult) {
        div_set('Chinese', "innerHTML_markdown", '');
        div_set('Japanese', "innerHTML_markdown", '');
        var result = (geminiResult);
        console.log(result);
        jsonResult = JSON.parse((result.slice(((result.indexOf('{') + 1) - 1), result.lastIndexOf('}') + 1)));
        if (jsonResult['Chinese']) {
            div_set('Chinese', "innerHTML_markdown", (jsonResult['Chinese']));
        }
        if (jsonResult['Japanese']) {
            div_set('Japanese', "innerHTML_markdown", (jsonResult['Japanese']));
        }
        if ((jsonResult['language']) == 'Chinese') {
            //if (checkbox_get('Japanese', "checked")) {
                await ttsSpeak(("Google 日本語"), (jsonResult['Japanese']));
                while (ttsSpeaking()) {
                    await delay(1);
                }                
            //}
        } else if ((jsonResult['language']) == 'Japanese') {
            //if (checkbox_get('Chinese', "checked")) {
                await ttsSpeak(("Google 國語（臺灣）"), (jsonResult['Chinese']));
                while (ttsSpeaking()) {
                    await delay(1);
                }                
            //}
        }

    };
    async function button_mic_mousedown(event) {
        button_set('mic', "color", '#ff0000');
    };
    document.getElementById('gamebutton_' + 'mic').addEventListener("mousedown", button_mic_mousedown, true);
    async function button_mic_touchstart(event) {
        button_set('mic', "color", '#ff0000');
    };
    document.getElementById('gamebutton_' + 'mic').addEventListener("touchstart", button_mic_touchstart, true);
    async function button_mic_mouseup(event) {
        button_set('mic', "color", '#000000');
        ttsSwitch(1);
    };
    document.getElementById('gamebutton_' + 'mic').addEventListener("mouseup", button_mic_mouseup, true);
    async function button_mic_touchend(event) {
        button_set('mic', "color", '#000000');
        ttsSwitch(1);
    };
    document.getElementById('gamebutton_' + 'mic').addEventListener("touchend", button_mic_touchend, true);
    async function button_volume_up_click(event) {
        ttsSwitch(1);
        if ((jsonResult['language']) == 'Chinese') {
            if (checkbox_get('Japanese', "checked")) {
                await ttsSpeak(("Google 日本語"), (jsonResult['Japanese']));
                while (ttsSpeaking()) {
                    await delay(1);
                }
            }
        } else if ((jsonResult['language']) == 'Japanese') {
            if (checkbox_get('Chinese', "checked")) {
                await ttsSpeak(("Google 國語（臺灣）"), (jsonResult['Chinese']));
                while (ttsSpeaking()) {
                    await delay(1);
                }
            }
        }
    };
    document.getElementById('gamebutton_' + 'volume_up').addEventListener("click", button_volume_up_click, true);    
};
main();
</script>
</body></html>
