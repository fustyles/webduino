<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta charset="utf-8">
  <title>myBlockly</title>
  <script>
	var script_blockly = [
		'https://blockly-demo.appspot.com/static/blockly_compressed.js',
		'https://blockly-demo.appspot.com/static/blocks_compressed.js',
		'https://blockly-demo.appspot.com/static/javascript_compressed.js',
		'https://fustyles.github.io/webduino/myBlockly/toolbox.js',
		
		'https://fustyles.github.io/webduino/myBlockly/example/Game_Tetris.js',
		'https://fustyles.github.io/webduino/myBlockly/example/Game_TicTacToe.js',
		'https://fustyles.github.io/webduino/myBlockly/example/Game_Bounce.js',
		'https://fustyles.github.io/webduino/myBlockly/example/Game_Hamster.js',
		'https://fustyles.github.io/webduino/myBlockly/example/Game_Puzzle.js',
		'https://fustyles.github.io/webduino/myBlockly/example/GameAuxiliary_example_001.js',
		'https://fustyles.github.io/webduino/myBlockly/example/GameAuxiliary_example_002.js',	
		'https://fustyles.github.io/webduino/myBlockly/example/GameCanvas_example_001.js',
		'https://fustyles.github.io/webduino/myBlockly/example/GameCanvas_example_002.js',
		'https://fustyles.github.io/webduino/myBlockly/example/GameCanvas_example_003.js',
		'https://fustyles.github.io/webduino/myBlockly/example/GameCanvas_example_004.js',
		'https://fustyles.github.io/webduino/myBlockly/example/MatrixLED_example_001.js',
		'https://fustyles.github.io/webduino/myBlockly/example/MatrixLED_example_002.js',
		'https://fustyles.github.io/webduino/myBlockly/example/MatrixLED_example_003.js',		
		'https://fustyles.github.io/webduino/myBlockly/example/ShowText_example_001.js',
		'https://fustyles.github.io/webduino/myBlockly/example/Keyboard_example_001.js',
		'https://fustyles.github.io/webduino/myBlockly/example/Keyboard_example_002.js',
		'https://fustyles.github.io/webduino/myBlockly/example/Instruction_example_001.js',
		'https://fustyles.github.io/webduino/myBlockly/example/Instruction_example_002.js',
		'https://fustyles.github.io/webduino/myBlockly/example/OpenURL_example_001.js',
		'https://fustyles.github.io/webduino/myBlockly/example/TaiwanAirQuality_example_001.js',
		'https://fustyles.github.io/webduino/myBlockly/example/SpeechRecognition_example_001.js',
		'https://fustyles.github.io/webduino/myBlockly/example/SpeechSynthesis_example_001.js',
		'https://fustyles.github.io/webduino/myBlockly/example/DeepLearning_example_001.js',
		'https://fustyles.github.io/webduino/myBlockly/example/KnnClassifier_example_001.js',
		'https://fustyles.github.io/webduino/myBlockly/example/Trackface_example_001.js',
		'https://fustyles.github.io/webduino/myBlockly/example/Trackface_example_002.js',		
		'https://fustyles.github.io/webduino/myBlockly/example/ESP8266_example_001.js',
		'https://fustyles.github.io/webduino/myBlockly/example/ESP8266_example_002.js',
		'https://fustyles.github.io/webduino/myBlockly/example/ESP8266_example_003.js',
		'https://fustyles.github.io/webduino/myBlockly/example/ESP8266_example_004.js',
		'https://fustyles.github.io/webduino/myBlockly/example/ESP8266_example_005.js',
		'https://fustyles.github.io/webduino/myBlockly/example/WebBit_example_001.js',
		'https://fustyles.github.io/webduino/myBlockly/example/WebBit_example_002.js',	
		'https://fustyles.github.io/webduino/myBlockly/example/WebBit_example_003.js',		
		'https://fustyles.github.io/webduino/myBlockly/example/ThingSpeak_example_001.js',
		'https://fustyles.github.io/webduino/myBlockly/example/HTChart_example_001.js',
		
		'https://fustyles.github.io/webduino/myBlockly/SetWindow/blocks_SetWindow.js',
		'https://fustyles.github.io/webduino/myBlockly/SetWindow/javascript_SetWindow.js',
		'https://fustyles.github.io/webduino/myBlockly/SetWindow/toolbox_SetWindow.js',
		
		'https://fustyles.github.io/webduino/myBlockly/ShowText/blocks_ShowText.js',
		'https://fustyles.github.io/webduino/myBlockly/ShowText/javascript_ShowText.js',
		'https://fustyles.github.io/webduino/myBlockly/ShowText/toolbox_ShowText.js',
		
		'https://fustyles.github.io/webduino/myBlockly/Keyboard/blocks_Keyboard.js',
		'https://fustyles.github.io/webduino/myBlockly/Keyboard/javascript_Keyboard.js',
		'https://fustyles.github.io/webduino/myBlockly/Keyboard/toolbox_Keyboard.js',
		
		'https://fustyles.github.io/webduino/myBlockly/Instruction/blocks_Instruction.js',
		'https://fustyles.github.io/webduino/myBlockly/Instruction/javascript_Instruction.js',
		'https://fustyles.github.io/webduino/myBlockly/Instruction/toolbox_Instruction.js',
		
		'https://fustyles.github.io/webduino/myBlockly/GameElements/blocks_GameElements.js',
		'https://fustyles.github.io/webduino/myBlockly/GameElements/javascript_GameElements.js',
		'https://fustyles.github.io/webduino/myBlockly/GameElements/toolbox_GameAuxiliary.js',
		'https://fustyles.github.io/webduino/myBlockly/GameElements/toolbox_GameTable.js',
		'https://fustyles.github.io/webduino/myBlockly/GameElements/toolbox_GameCanvas.js',
		'https://fustyles.github.io/webduino/myBlockly/GameElements/toolbox_GameImage.js',
		'https://fustyles.github.io/webduino/myBlockly/GameElements/toolbox_GameForm.js',
		
		'https://fustyles.github.io/webduino/myBlockly/OpenURL/blocks_OpenURL.js',
		'https://fustyles.github.io/webduino/myBlockly/OpenURL/javascript_OpenURL.js',
		'https://fustyles.github.io/webduino/myBlockly/OpenURL/toolbox_OpenURL.js',
		
		'https://fustyles.github.io/webduino/myBlockly/TaiwanAirQuality/blocks_TaiwanAirQuality.js',
		'https://fustyles.github.io/webduino/myBlockly/TaiwanAirQuality/javascript_TaiwanAirQuality.js',
		'https://fustyles.github.io/webduino/myBlockly/TaiwanAirQuality/toolbox_TaiwanAirQuality.js',
		
		'https://fustyles.github.io/webduino/myBlockly/SpeechRecognition/blocks_SpeechRecognition.js',
		'https://fustyles.github.io/webduino/myBlockly/SpeechRecognition/javascript_SpeechRecognition.js',
		'https://fustyles.github.io/webduino/myBlockly/SpeechRecognition/toolbox_SpeechRecognition.js',	
		
		'https://fustyles.github.io/webduino/myBlockly/TextToSpeech/blocks_TextToSpeech.js',
		'https://fustyles.github.io/webduino/myBlockly/TextToSpeech/javascript_TextToSpeech.js',
		'https://fustyles.github.io/webduino/myBlockly/TextToSpeech/toolbox_TextToSpeech.js',	
		
		'https://fustyles.github.io/webduino/myBlockly/DeepLearning/blocks_DeepLearning.js',
		'https://fustyles.github.io/webduino/myBlockly/DeepLearning/javascript_DeepLearning.js',
		'https://fustyles.github.io/webduino/myBlockly/DeepLearning/toolbox_DeepLearning.js',
		
		'https://fustyles.github.io/webduino/myBlockly/KnnClassifier/blocks_KnnClassifier.js',
		'https://fustyles.github.io/webduino/myBlockly/KnnClassifier/javascript_KnnClassifier.js',
		'https://fustyles.github.io/webduino/myBlockly/KnnClassifier/toolbox_KnnClassifier.js',		
		
		'https://fustyles.github.io/webduino/myBlockly/tracking/blocks_Trackface.js',
		'https://fustyles.github.io/webduino/myBlockly/tracking/javascript_Trackface.js',
		'https://fustyles.github.io/webduino/myBlockly/tracking/toolbox_Trackface.js',			
		
		'https://fustyles.github.io/webduino/myBlockly/ESP8266/blocks_ESP8266.js',
		'https://fustyles.github.io/webduino/myBlockly/ESP8266/javascript_ESP8266.js',
		'https://fustyles.github.io/webduino/myBlockly/ESP8266/toolbox_ESP8266.js',
		
		'https://fustyles.github.io/webduino/myBlockly/WebBit/blocks_WebBit.js',
		'https://fustyles.github.io/webduino/myBlockly/WebBit/javascript_WebBit.js',
		'https://fustyles.github.io/webduino/myBlockly/WebBit/toolbox_WebBit.js',
		
		'https://fustyles.github.io/webduino/myBlockly/MatrixLed/blocks_MatrixLed.js',
		'https://fustyles.github.io/webduino/myBlockly/MatrixLed/javascript_MatrixLed.js',
		'https://fustyles.github.io/webduino/myBlockly/MatrixLed/toolbox_MatrixLed.js',			
		
		'https://fustyles.github.io/webduino/myBlockly/ThingSpeak/blocks_ThingSpeak.js',
		'https://fustyles.github.io/webduino/myBlockly/ThingSpeak/javascript_ThingSpeak.js',
		'https://fustyles.github.io/webduino/myBlockly/ThingSpeak/toolbox_ThingSpeak.js',
		
		'https://fustyles.github.io/webduino/myBlockly/IFTTT/blocks_IFTTT.js',
		'https://fustyles.github.io/webduino/myBlockly/IFTTT/javascript_IFTTT.js',
		'https://fustyles.github.io/webduino/myBlockly/IFTTT/toolbox_IFTTT.js',
		
		'https://fustyles.github.io/webduino/myBlockly/LINE/blocks_LINE.js',
		'https://fustyles.github.io/webduino/myBlockly/LINE/javascript_LINE.js',
		'https://fustyles.github.io/webduino/myBlockly/LINE/toolbox_LINE.js',	
		
		'https://fustyles.github.io/webduino/myBlockly/HTChart/blocks_HTChart.js',
		'https://fustyles.github.io/webduino/myBlockly/HTChart/javascript_HTChart.js',
		'https://fustyles.github.io/webduino/myBlockly/HTChart/toolbox_HTChart.js',			
		
		'https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js'
	];
	for (var i=0;i<script_blockly.length;i++) {
	  document.write("\<script src='"+script_blockly[i]+"'\>\<\/script>");
	}
	var language = location.search.toLowerCase();
	if (language.indexOf("lang=zh-hant")!=-1)
	{
		var script_msg = [
		'https://fustyles.github.io/webduino/myBlockly/zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/SetWindow/msg_SetWindow_zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/ShowText/msg_ShowText_zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/Keyboard/msg_Keyboard_zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/Instruction/msg_Instruction_zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/GameElements/msg_GameElements_zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/OpenURL/msg_OpenURL_zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/TaiwanAirQuality/msg_TaiwanAirQuality_zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/SpeechRecognition/msg_SpeechRecognition_zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/TextToSpeech/msg_TextToSpeech_zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/DeepLearning/msg_DeepLearning_zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/KnnClassifier/msg_KnnClassifier_zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/tracking/msg_Trackface_zh-hant.js',			
		'https://fustyles.github.io/webduino/myBlockly/ESP8266/msg_ESP8266_zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/WebBit/msg_WebBit_zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/MatrixLed/msg_MatrixLed_zh-hant.js',				
		'https://fustyles.github.io/webduino/myBlockly/ThingSpeak/msg_ThingSpeak_zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/IFTTT/msg_IFTTT_zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/LINE/msg_LINE_zh-hant.js',
		'https://fustyles.github.io/webduino/myBlockly/HTChart/msg_HTChart_zh-hant.js'
		];
	} 
	else if (language.indexOf("lang=zh-hans")!=-1) {
		var script_msg = [
		'https://fustyles.github.io/webduino/myBlockly/zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/SetWindow/msg_SetWindow_zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/ShowText/msg_ShowText_zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/Keyboard/msg_Keyboard_zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/Instruction/msg_Instruction_zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/GameElements/msg_GameElements_zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/OpenURL/msg_OpenURL_zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/TaiwanAirQuality/msg_TaiwanAirQuality_zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/SpeechRecognition/msg_SpeechRecognition_zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/TextToSpeech/msg_TextToSpeech_zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/DeepLearning/msg_DeepLearning_zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/KnnClassifier/msg_KnnClassifier_zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/tracking/msg_Trackface_zh-hans.js',			
		'https://fustyles.github.io/webduino/myBlockly/ESP8266/msg_ESP8266_zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/WebBit/msg_WebBit_zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/MatrixLed/msg_MatrixLed_zh-hans.js',			
		'https://fustyles.github.io/webduino/myBlockly/ThingSpeak/msg_ThingSpeak_zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/IFTTT/msg_IFTTT_zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/LINE/msg_LINE_zh-hans.js',
		'https://fustyles.github.io/webduino/myBlockly/HTChart/msg_HTChart_zh-hans.js'
		];
	} 
	else {
		var script_msg = [
		'https://fustyles.github.io/webduino/myBlockly/en.js',
		'https://fustyles.github.io/webduino/myBlockly/SetWindow/msg_SetWindow.js',
		'https://fustyles.github.io/webduino/myBlockly/ShowText/msg_ShowText.js',
		'https://fustyles.github.io/webduino/myBlockly/Keyboard/msg_Keyboard.js',
		'https://fustyles.github.io/webduino/myBlockly/Instruction/msg_Instruction.js',
		'https://fustyles.github.io/webduino/myBlockly/GameElements/msg_GameElements.js',
		'https://fustyles.github.io/webduino/myBlockly/OpenURL/msg_OpenURL.js',
		'https://fustyles.github.io/webduino/myBlockly/TaiwanAirQuality/msg_TaiwanAirQuality.js',
		'https://fustyles.github.io/webduino/myBlockly/SpeechRecognition/msg_SpeechRecognition.js',
		'https://fustyles.github.io/webduino/myBlockly/TextToSpeech/msg_TextToSpeech.js',
		'https://fustyles.github.io/webduino/myBlockly/DeepLearning/msg_DeepLearning.js',
		'https://fustyles.github.io/webduino/myBlockly/KnnClassifier/msg_KnnClassifier.js',
		'https://fustyles.github.io/webduino/myBlockly/tracking/msg_Trackface.js',			
		'https://fustyles.github.io/webduino/myBlockly/ESP8266/msg_ESP8266.js',
		'https://fustyles.github.io/webduino/myBlockly/WebBit/msg_WebBit.js',
		'https://fustyles.github.io/webduino/myBlockly/MatrixLed/msg_MatrixLed.js',			
		'https://fustyles.github.io/webduino/myBlockly/ThingSpeak/msg_ThingSpeak.js',
		'https://fustyles.github.io/webduino/myBlockly/IFTTT/msg_IFTTT.js',
		'https://fustyles.github.io/webduino/myBlockly/LINE/msg_LINE.js',
		'https://fustyles.github.io/webduino/myBlockly/HTChart/msg_HTChart.js'
		];
	}
	for (var i=0;i<script_msg.length;i++) {
	  document.write("\<script src='"+script_msg[i]+"'\>\<\/script>");
	}
	var script_iframe_run = [
		'https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js',
		'https://fustyles.github.io/webduino/myBlockly/ShowText/showtext.js',
		'https://fustyles.github.io/webduino/myBlockly/SetWindow/setwindow.js',
		'https://fustyles.github.io/webduino/myBlockly/GameElements/gameelements.js',
		'https://fustyles.github.io/webduino/myBlockly/OpenURL/openurl.js',
		'https://fustyles.github.io/webduino/myBlockly/TaiwanAirQuality/taiwanairquality.js',
		'https://fustyles.github.io/webduino/myBlockly/SpeechRecognition/speechrecognition.js',
		'https://fustyles.github.io/webduino/myBlockly/TextToSpeech/texttospeech.js',
		'https://fustyles.github.io/webduino/myBlockly/DeepLearning/deeplearning.js',
		'https://fustyles.github.io/webduino/myBlockly/KnnClassifier/knnclassifier.js',
		'https://fustyles.github.io/webduino/myBlockly/tracking/trackface.js',		
		'https://fustyles.github.io/webduino/myBlockly/ESP8266/esp8266.js',
		'https://fustyles.github.io/webduino/myBlockly/WebBit/webbit.js',
		'https://fustyles.github.io/webduino/myBlockly/MatrixLed/matrixled.js',		
		'https://fustyles.github.io/webduino/myBlockly/ThingSpeak/thingspeak.js',
		'https://fustyles.github.io/webduino/myBlockly/IFTTT/ifttt.js',
		'https://fustyles.github.io/webduino/myBlockly/LINE/line.js',
		'https://fustyles.github.io/webduino/myBlockly/HTChart/htchart.js',
		'https://d3js.org/d3.v4.min.js'
	];
  </script>
</head>
<body onload="initial();">

<table id="mySpace" style="position:absolute;display:none;height:100%">
  <tr id="mySpacetr">
    <td valign="center">
      <br><br><button id="btnRun1" onclick="document.getElementById('btnRun').disabled=true;runCode();">Run</button>
      <br><br><input type="button" id="hide" value="  >  " onclick="hideMySpace(this);">
    </td>
    <td>
      <table id="myFeatures">
        <tr>
          <td align="left" valign="center">
            <button id="btnexportcode" onclick="exportCODE();">Export Code</button>
            <button id="btnexporthtml" onclick="exportHTML();">Export HTML</button>
            <button id="btnexportblocks" onclick="exportBlocks();">Backup Blocks(XML)</button>
          </td>
        </tr>
        <tr>
          <td align="left" valign="center">
            <button id="btnimportblocks" onclick="importBlocks()">Import Blocks(XML)</button><input id="myfile"  type="file" onchange ="importBlocksFile(this);" accept=".txt,.xml">
          </td>
        </tr>
        <tr>
          <td align="left" valign="center">
            <button id="btnclearworkspace" onclick="demoWorkspace.clear();">Clear Workspace</button>&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" id="chkbackup" onclick="exportBlocks();var backupTimer = setInterval(function(){if (document.getElementById('chkbackup').checked) exportBlocks();}, 300000);"><span id="backuptimer">Backup Blocks (every 5 min)</span>
          </td>
        </tr>
        <tr>
          <td>
            <span id="left">left</span><input type="text" id="ifrLeft" size="1" value="300" onfocus="this.select()">&nbsp;<span id="top">top</span><input type="text" id="ifrTop" size="1" value="20" onfocus="this.select()">&nbsp;<span id="width">width</span><input type="text" id="ifrWidth" size="1" value="600" onfocus="this.select()">&nbsp;<span id="height">height</span><input type="text" id="ifrHeight" size="1" value="600" onfocus="this.select()">
          </td>
        </tr>	      
        <tr>
          <td align="left" valign="center">
            <span id="example">Example</span>
            <select onchange="if (this.value!='') XmldomToWorkspace(eval(this.value));this.value='';">
              <option value=""></option>
	      <option value="Game_Tetris">Game_Tetris</option>
              <option value="Game_TicTacToe">Game_TicTacToe</option>
	      <option value="Game_Bounce">Game_Bounce</option>
	      <option value="Game_Hamster">Game_Hamster</option>
	      <option value="Game_Puzzle">Game_Puzzle</option>
              <option value="ShowText_example_001">ShowText_example_001</option>
	      <option value="SpeechRecognition_example_001">SpeechRecognition_example_001</option>
	      <option value="SpeechSynthesis_example_001">SpeechSynthesis_example_001</option>	
	      <option value="Trackface_example_001">Trackface_example_001</option>
	      <option value="Trackface_example_002">Trackface_example_002</option>		    
              <option value="Keyboard_example_001">Keyboard_example_001</option>
              <option value="Keyboard_example_002">Keyboard_example_002</option>		    
              <option value="Instruction_example_001">Instruction_example_001</option>
              <option value="Instruction_example_002">Instruction_example_002</option>			    
	      <option value="GameAuxiliary_example_001">GameAuxiliary_example_001</option>
	      <option value="GameAuxiliary_example_002">GameAuxiliary_example_002</option>		    
	      <option value="GameCanvas_example_001">GameCanvas_example_001</option>
	      <option value="GameCanvas_example_002">GameCanvas_example_002</option>
	      <option value="GameCanvas_example_003">GameCanvas_example_003</option>
	      <option value="GameCanvas_example_004">GameCanvas_example_004</option>	
	      <option value="DeepLearning_example_001">DeepLearning_example_001</option>
	      <option value="KnnClassifier_example_001">KnnClassifier_example_001</option>
	      <option value="MatrixLED_example_001">MatrixLED_example_001</option>
	      <option value="MatrixLED_example_002">MatrixLED_example_002</option>	
	      <option value="MatrixLED_example_003">MatrixLED_example_003</option>
              <option value="OpenURL_example_001">OpenURL_example_001</option>
              <option value="TaiwanAirQuality_example_001">TaiwanAirQuality_example_001</option>
	      <option value="ThingSpeak_example_001">ThingSpeak_example_001</option>
	      <option value="HTChart_example_001">HTChart_example_001</option>		    
	      <option value="ESP8266_example_001">ESP8266_example_001</option>
	      <option value="ESP8266_example_002">ESP8266_example_002</option>
	      <option value="ESP8266_example_003">ESP8266_example_003</option>
	      <option value="ESP8266_example_004">ESP8266_example_004</option>	
	      <option value="ESP8266_example_005">ESP8266_example_005</option>
	      <option value="WebBit_example_001">WebBit_example_001</option>
	      <option value="WebBit_example_002">WebBit_example_002</option>
	      <option value="WebBit_example_003">WebBit_example_003</option>		    
            </select>
          </td>
        </tr>
        <tr>
          <td>
            <span id="language">Language</span>
            <select onchange="var url=location.href.split('?')[0];location.href=url+'?lang='+this.value;">
              <option value=""></option>
              <option value="en">en</option>
              <option value="zh-Hant">zh-Hant</option>
              <option value="zh-Hans">zh-Hans</option>
            </select>
          </td>
        </tr>	      
        <tr>
          <td>
            <textarea id="codeWindow" style="width:350px;height:400px;" readonly ondblclick="showcodeWindow(this,'big');" onfocusout="showcodeWindow(this,'small');"></textarea>
	  </td>
        </tr>
        <tr>
          <td align="center">
            Fu Chung-Yi (Taiwan)  Update Date : 2019-2-10
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>

<div id="runWindow" style="left:250px;top:10px;position:absolute;display:none;z-index:9999" align="left" draggable="true" ondragstart="document.getElementById('iframe_run').style.display='none';" ondragend="this.title='true';">
  <button id="btndrag">Drag</button><button id="btnfullscreen" onclick="document.getElementById('iframe_run').requestFullscreen();document.getElementById('iframe_run').focus();">Full Screen</button><button id="btnRun" onclick="document.getElementById('btnRun').disabled=true;runCode();">Run Code</button><button id="btnstopcode" onclick="document.getElementById('btnRun').disabled=false;stopCode();">Stop Code</button><button id="btnclosewindow" onclick="closeWindow();">X</button>
  <br>
  <iframe id="iframe_run" style="width:600px;height:600px;background-color: white" frameborder="1"  scrolling="auto" allowpaymentrequest allow="autoplay; fullscreen; geolocation; microphone; camera ; usb"></iframe>
</div>

<div id="blocklyDiv" style="height: 600px; width: 800px;">
<xml id="toolbox" style="display: none"></xml>
<xml id="startBlocks" style="display: none"></xml>
		
<script>

//append category to toolbox
var category = [
	catSystem,
	"<sep></sep>",
	catSetWindow,
	catShowText,
	catKeyboard,
	catSpeechRecognition,
	catTextToSpeech,
	catTrackface,	
	catInstruction,
	catGameAuxiliary,
	catGameTable,
	catGameCanvas,
	catGameImage,
	catGameForm,
	catKnnClassifier,
	catOpenURL,
	catMatrixLed,	
	catTaiwanAirQuality,
	catThingSpeak,
	catIFTTT,
	catLINE,
	catHTChart,
	catESP8266,
	catWebBit	
].join("");
while (category.toLowerCase().indexOf("<category")!=-1||category.toLowerCase().indexOf("<sep>")!=-1) {
  var s = category.toLowerCase().indexOf("<category");
  var s1 = category.toLowerCase().indexOf("<sep>");
  if (s1!=-1&&s1<s) {
    var e1 = category.toLowerCase().indexOf("</sep>");
    var xml = Blockly.Xml.textToDom("<xml>"+category.substring(s1,e1+6)+"</xml>");
    document.getElementById('toolbox').append(xml.firstChild);
    category=category.substr(e1+6);
  } else {
    var e = category.toLowerCase().indexOf("</category>");
    var xml = Blockly.Xml.textToDom("<xml>"+category.substring(s,e+11)+"</xml>");
    document.getElementById('toolbox').append(xml.firstChild);
    category=category.substr(e+11);
  }
}
	
var demoWorkspace = Blockly.inject('blocklyDiv',{media: 'https://blockly-demo.appspot.com/static/media/', toolbox: document.getElementById('toolbox'),zoom:{controls: true,wheel: true,startScale: 1.0,maxScale: 3,minScale: 0.3,scaleSpeed: 1.2},trashcan: true});
Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'),demoWorkspace);	
	
//append initial blocks to startBlocks
XmldomToWorkspace(Game_TicTacToe);
	
function XmldomToWorkspace(example) {	
  var xml = Blockly.Xml.textToDom(example);
  demoWorkspace.clear();
  Blockly.Xml.domToWorkspace(xml, demoWorkspace);
}
	
function showCode() {
  Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
  var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
  if (code=="") code="//Please open this site in Google Chrome Browser.\n//You can double click on the textarea to enlarge.";
  document.getElementById('codeWindow').innerHTML = code;
}
demoWorkspace.addChangeListener(showCode);
	
function runCode() {
  window.LoopTrap = 1000;
  Blockly.JavaScript.INFINITE_LOOP_TRAP =
  'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
  var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
  var iframe_code="\<html\>\<head\>\<meta charset='utf-8'\>";
  for (var i=0;i<script_iframe_run.length;i++)  {
    iframe_code += "\<script src='"+script_iframe_run[i]+"'\>\<\/script\>";
  }
		
  var xml = Blockly.Xml.workspaceToDom(demoWorkspace);
  var xml_text = Blockly.Xml.domToText(xml);

  //Deep Learning
  if (xml_text.indexOf("teachable")!=-1) {
    iframe_code += "\<script src='https://fustyles.github.io/webduino/myBlockly/DeepLearning/teachablemachineboilerplate.js'\>\<\/script\>";
  }	
	
  //KNN-Classifier
  if (xml_text.indexOf("knnclassifier")!=-1) {
    iframe_code += "\<script src='https://fustyles.github.io/webduino/myBlockly/KnnClassifier/knnclassifier_video.js'\>\<\/script\>";
  }	
    
  iframe_code += "\<\/head\>\<body\>\<script\>const delay=(seconds)=>{return new Promise((resolve)=>{setTimeout(resolve,seconds*1000);});};const main=async()=>{"+code+"};main();\<\/script\>\<\/body\>\<\/html\>";
  Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
  try {
    document.getElementById("runWindow").style.left = document.getElementById("ifrLeft").value + "px";
    document.getElementById("runWindow").style.top = document.getElementById("ifrTop").value + "px";
    document.getElementById("iframe_run").style.width = document.getElementById("ifrWidth").value + "px";
    document.getElementById("iframe_run").style.height = document.getElementById("ifrHeight").value + "px";
    document.getElementById("runWindow").style.display = "block";
    document.getElementById("iframe_run").style.display = "block";
	   
    var iframe = document.getElementById("iframe_run");
    iframe.contentWindow.document.open();
    iframe.contentWindow.document.write(iframe_code);
    iframe.contentWindow.document.close();
    document.getElementById("iframe_run").focus();
  } catch (e) {
    alert(e);
  }
}
	
function stopCode() {
  try {	
    document.getElementById("iframe_run").src="about:blank";
  } catch (e) {
    alert(e);
  }
}
	
function closeWindow() {
  try {	
    stopCode();	  
    document.getElementById("runWindow").style.display = "none";
  } catch (e) {
    alert(e);
  }	  
}
	
function exportCODE() {
  try {
    var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
	  
    var link = document.createElement('a');
    link.download="code.js";
    link.href="data:application/octet-stream;utf-8," + encodeURIComponent(code);
    document.body.appendChild(link);
    link.click();
    link.remove();
  } catch (e) {
    window.location.href="data:application/octet-stream;utf-8," + encodeURIComponent(code);
    alert(e);
  }
}
	
function exportHTML() {
  try {
    var code = Blockly.JavaScript.workspaceToCode(demoWorkspace);
    var iframe_code="\<html\>\<head\>\<meta charset='utf-8'\>";
    for (var i=0;i<script_iframe_run.length;i++)  {
      iframe_code += "\<script src='"+script_iframe_run[i]+"'\>\<\/script\>";
    }
	  
    var xml = Blockly.Xml.workspaceToDom(demoWorkspace);
    var xml_text = Blockly.Xml.domToText(xml);
	  
    //Deep Learning
    if (xml_text.indexOf("teachable")!=-1) {
      iframe_code += "\<script src='https://fustyles.github.io/webduino/myBlockly/DeepLearning/teachablemachineboilerplate.js'\>\<\/script\>";
    }
	  
    //KNN-Classifier
    if (xml_text.indexOf("knnclassifier")!=-1) {
      iframe_code += "\<script src='https://fustyles.github.io/webduino/myBlockly/KnnClassifier/knnclassifier_video.js'\>\<\/script\>";
    }		  
	  
    iframe_code += "\<\/head\>\<body\>\<script\>const delay=(seconds)=>{return new Promise((resolve)=>{setTimeout(resolve,seconds*1000);});};const main=async()=>{"+code+"};main();\<\/script\>\<\/body\>\<\/html\>";
    
    var link = document.createElement('a');
    link.download="project.html";
    link.href="data:application/octet-stream;utf-8," + encodeURIComponent(iframe_code);	  
    document.body.appendChild(link);
    link.click();
    link.remove();
  } catch (e) {
    window.location.href="data:application/octet-stream;utf-8," + encodeURIComponent(iframe_code);
    alert(e);
  }
}
		
function exportBlocks() {
  try {
    var xml = Blockly.Xml.workspaceToDom(demoWorkspace);
    var xml_text = Blockly.Xml.domToText(xml);
	  
    var link = document.createElement('a');
    link.download="project.txt";
    link.href="data:application/octet-stream;utf-8," + encodeURIComponent(xml_text);
    document.body.appendChild(link);
    link.click();
    link.remove();
  } catch (e) {
    window.location.href="data:application/octet-stream;utf-8," + encodeURIComponent(xml_text);
    alert(e);
  }
}
	
function importBlocks() {
  try {
    var xml_text = prompt("Please enter XML code", "");
    var xml = Blockly.Xml.textToDom(xml_text);
    demoWorkspace.clear();
    Blockly.Xml.domToWorkspace(xml, demoWorkspace);
  } catch (e) {
    alert(e);
  }
}
	
function importBlocksFile(element) {
  try {	
    var file = element.files[0];
    var fr = new FileReader();           
    fr.onload = function (event) {
      var xml = Blockly.Xml.textToDom(event.target.result);
      demoWorkspace.clear();
      Blockly.Xml.domToWorkspace(xml, demoWorkspace);
    };
    fr.readAsText(file);
  } catch (e) {
    alert(e);
  }	  
}
	
function initial() {
  var myWidth = document.body.clientWidth;
  if (document.documentElement.clientHeight)
    var myHeight = document.documentElement.clientHeight-25;
  else
    var myHeight = document.body.clientHeight;
  document.getElementById('blocklyDiv').style.width=(myWidth-470) +"px";
  document.getElementById('blocklyDiv').style.height=myHeight +"px";
  Blockly.svgResize(demoWorkspace);
  document.getElementById('codeWindow').style.height=(myHeight-200) +"px";
  document.getElementById('mySpace').style.left=(myWidth-440) +"px";
  document.getElementById('mySpace').style.height=myHeight +"px";
  document.getElementById('mySpacetr').style.height=myHeight +"px";
  document.getElementById('mySpace').style.display="block";
  document.getElementById('btnRun').innerHTML = Blockly.Msg.btnRun_TEXT;
  document.getElementById('btnRun1').innerHTML = Blockly.Msg.btnRun1_TEXT;
  document.getElementById('btnexportcode').innerHTML = Blockly.Msg.btnexportcode_TEXT;
  document.getElementById('btnexporthtml').innerHTML = Blockly.Msg.btnexporthtml_TEXT;
  document.getElementById('btnexportblocks').innerHTML = Blockly.Msg.btnexportblocks_TEXT;
  document.getElementById('btnimportblocks').innerHTML = Blockly.Msg.btnimportblocks_TEXT;
  document.getElementById('btnclearworkspace').innerHTML = Blockly.Msg.btnclearworkspace_TEXT;	
  document.getElementById('left').innerHTML = Blockly.Msg.left_TEXT;
  document.getElementById('top').innerHTML = Blockly.Msg.top_TEXT;
  document.getElementById('width').innerHTML = Blockly.Msg.width_TEXT;
  document.getElementById('height').innerHTML = Blockly.Msg.height_TEXT;
  document.getElementById('backuptimer').innerHTML = Blockly.Msg.backuptimer_TEXT;
  document.getElementById('example').innerHTML = Blockly.Msg.example_TEXT;
  document.getElementById('language').innerHTML = Blockly.Msg.language_TEXT;	
  document.getElementById('btndrag').innerHTML = Blockly.Msg.btndrag_TEXT;
  document.getElementById('btnstopcode').innerHTML = Blockly.Msg.btnstopcode_TEXT;
  document.getElementById('btnclosewindow').innerHTML = Blockly.Msg.btnclosewindow_TEXT;
  document.getElementById('btnfullscreen').innerHTML = Blockly.Msg.btnfullscreen_TEXT;
}
	
function hideMySpace(element) {
  var myWidth = document.body.clientWidth;
  if (document.documentElement.clientHeight)
    var myHeight = document.documentElement.clientHeight-25;
  else
    var myHeight = document.body.clientHeight;	
  if (document.getElementById('myFeatures').style.display != 'none') { 
    document.getElementById('myFeatures').style.display = 'none';
    element.value='  <  ';
    document.getElementById('mySpace').style.left=(myWidth-40) +"px";
    document.getElementById('blocklyDiv').style.width=(myWidth-70) +"px";
  } else {
    document.getElementById('myFeatures').style.display = 'block';
    element.value='  >  ';
    document.getElementById('mySpace').style.left=(myWidth-440) +"px";
    document.getElementById('blocklyDiv').style.width=(myWidth-470) +"px";
  }
  Blockly.svgResize(demoWorkspace);
}
	
function showcodeWindow(element, state) {
  var myWidth = document.body.clientWidth;
  if (document.documentElement.clientHeight)
    var myHeight = document.documentElement.clientHeight-25;
  else
    var myHeight = document.body.clientHeight;
  if (state=="big")
  {
    element.style.position='absolute';
    element.style.left="-"+(myWidth-450)+"px";
    element.style.top='0px';
    element.style.width=(myWidth-480)+"px";
    element.style.height=myHeight +"px";
    element.style.fontSize='18px';
    element.style.color='red';
    element.style.zIndex='999';
    element.selectionStart = 0;
    element.selectionEnd = 0;
    element.focus();
  } else if (state=="small") {
    element.style.position='static';
    element.style.width='360px';
    element.style.height=(myHeight-200) +"px";
    element.style.fontSize='13px';
    element.style.color='black';
  }
}
	
window.onresize = function(){
  showcodeWindow(document.getElementById('codeWindow'),"small");
  if (document.getElementById('myFeatures').style.display == 'none') 
    document.getElementById('hide').click();
  initial();
}
	
window.onmousemove = function() { 
  var obj = document.getElementById('runWindow');
  if (obj.title=='true') {
    obj.title='false';
    obj.style.left=(event.pageX-8)+'px';
    obj.style.top=(event.pageY-8)+'px';
    document.getElementById('iframe_run').style.display="block"; 
  }
};

window.onbeforeunload = function(){ 
  return "Data may not be stored yet. Are you sure?"; 
}
</script>
</body>
</html>
